---
title: "New approach to annotation constraints"
author: "Gavin King"
creation_date: "02-06-2011"
blogger_name: "Gavin"
layout: blog-post
tags: [Ceylon]
slug: NewApproachToAnnotationConstraints
lace: http://in.relation.to/20647.lace
---
<div id="documentDisplay" class="documentDisplay">


<p class="wikiPara">
Today I came up with an awesome new way to do annotation constraints in Ceylon, essentially using the metamodel types (yes, I mean the metamodel <i class="wikiEmphasis">types</i>, not the actual metamodel type instances) as a kind of query language for program elements. The advantages of the new approach are:
</p>

<ul class="wikiUnorderedList">
<li class="wikiUnorderedListItem"> <a href="http://in.relation.to/Bloggers/IntroductionToCeylonPart12#H-AnnotationConstraints" target="" class="regularLink">annotation constraints</a> are much more expressive â€” as expressive as the metamodel, and </li>
<li class="wikiUnorderedListItem"> reading <a href="http://in.relation.to/Bloggers/IntroductionToCeylonPart12#H-ReadingAnnotationValuesAtRuntime" target="" class="regularLink">annotation values</a> at runtime is more typesafe. </li>
</ul>

<p class="wikiPara">
Instead of writing it up here, I just went back and updated <a href="/Bloggers/IntroductionToCeylonPart12" target="" class="regularLink">Introduction to Ceylon Part 12</a> to discuss the new approach. You may as well re-read it from the start.
</p>

<p class="wikiPara">
Getting the <tt>ConstrainedAnnotation</tt> type hierarchy correct was slightly tricky, but fortunately I had the Ceylon compiler's type analyzer helping me. I got <a href="/Bloggers/IntroductionToCeylonPart3" target="" class="regularLink">inheritance</a>, <a href="/Bloggers/IntroductionToCeylonPart6" target="" class="regularLink">generics</a>, <a href="http://in.relation.to/Bloggers/IntroductionToCeylonPart6#H-GenericTypeConstraints" target="" class="regularLink">upper bound type constraints</a>, and <a href="http://in.relation.to/Bloggers/IntroductionToCeylonPart6#H-CovarianceAndContravariance" target="" class="regularLink">covariance/contravariance</a> working in the type analyzer several months ago, but this is the first chance I had to see some value out of that. The type analyzer is already much smarter than me at reasoning about generic types.
</p>

<p class="wikiPara">
P.S. You might notice that all the example Ceylon code on this blog now has syntax highlighting. Thanks, Stephane and Shane!</p>
</div>
<div id="disqus_thread"></div><script type="text/javascript">
    var disqus_shortname = 'otnoitalerni';
    var disqus_identifier = 'NewApproachToAnnotationConstraints';
    var disqus_title = 'New approach to annotation constraints';
    var disqus_url = 'http://in.relation.to/20647.lace';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
